#!/bin/bash

# Setup VSCode/Cursor settings with symlinks to centralized configuration

set -e

CONFIG_FILE="$HOME/.oh-my-zsh/custom/config/settings.jsonc"

# VSCode settings paths
VSCODE_SETTINGS="$HOME/Library/Application Support/Code/User/settings.json"
CURSOR_SETTINGS="$HOME/Library/Application Support/Cursor/User/settings.json"

# Function to create symlink for settings
create_settings_symlink() {
    local target="$1"
    local target_dir=$(dirname "$target")
    
    # Create directory if it doesn't exist
    mkdir -p "$target_dir"
    
    # Backup existing settings if they exist and are not already symlinks
    if [ -f "$target" ] && [ ! -L "$target" ]; then
        cp "$target" "$target.backup.$(date +%Y%m%d_%H%M%S)" 2>/dev/null
        rm "$target"
    elif [ -L "$target" ]; then
        # Remove existing symlink
        rm "$target"
    fi
    
    # Create symlink to centralized config
    ln -s "$CONFIG_FILE" "$target" 2>/dev/null
}

# Check which editor is installed and create symlinks
if [ -d "$(dirname "$CURSOR_SETTINGS")" ]; then
    create_settings_symlink "$CURSOR_SETTINGS" >/dev/null 2>&1
fi

if [ -d "$(dirname "$VSCODE_SETTINGS")" ]; then
    create_settings_symlink "$VSCODE_SETTINGS" >/dev/null 2>&1
fi

echo "âœ“ VSCode settings setup complete"